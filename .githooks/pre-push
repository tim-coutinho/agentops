#!/usr/bin/env bash
# bd-shim v1 + pre-push gate
# bd-hooks-version: 0.49.3
#
# Pre-push hook: runs lightweight validation gate, then delegates to bd.
# Gate checks: go build/vet, race tests on changed packages, embedded sync,
# skill count sync.

set -euo pipefail

REPO_ROOT="$(cd "$(dirname "$0")/.." && pwd)"

# --- Pre-push validation gate ---
if [[ -x "$REPO_ROOT/scripts/pre-push-gate.sh" ]]; then
    if ! "$REPO_ROOT/scripts/pre-push-gate.sh"; then
        echo "pre-push: blocked by validation gate. Fix issues before pushing."
        exit 1
    fi
fi

# --- bd issue tracking (existing behavior) ---
if command -v bd >/dev/null 2>&1; then
    bd hooks run pre-push "$@"
fi
